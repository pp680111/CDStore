<?php 
    require_once('CDStore_fns.php');
    $recommend_list = get_recommend_list();
    $cd_list = get_cd_list();
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="0"> 
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/myStyle.css">
    <title>Welcome to ZST's CDStore</title>
</head>
<body>  
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-10 col-xs-offset-1 content">
                <h2>今日推荐</h2>
                <div class="my_slide">
                    <span class="glyphicon glyphicon-backward"></span></section>
	                <span class="glyphicon glyphicon-forward"></span></section>
                    <ul>
                        <?php 
                            foreach($recommend_list as $value)
                            {
                                echo "<li><a href='cd_detail.php?id={$value[0]}'><img src='/static/img/cover/{$value[0]}.jpg' width='300px' height='300px'></a></li>";
                            }
                        ?>
                    </ul>
                </div>

                <div class="row">
                    <div class="col-xs-2">
                        <ul class="list-group order_controll">
                            <li class="list-group-item" id="sort_by_name">按专辑名排序</li>
                            <li class="list-group-item" id="sort_by_artist">按艺术家名排序</li>
                            <li class="list-group-item" id="sort_by_create_time">按上架时间排序</li>
                        </ul>
                    </div>
                    <div class="col-xs-10">
                        <h3>唱片列表</h3>
                        <table class="table cd_table" id="cd_table">
                            <tbody>
                                <?php
                                    $i = 0;
                                    echo '<tr>';
                                    foreach($cd_list as $cd)
                                    {
                                        if($i == 4)
                                        {
                                            echo '</tr><tr>';
                                            $i = 0;
                                        }
                                        echo "<td><a href='cd_detail.php?id={$cd['id']}'><img src='/static/img/cover/{$cd['id']}.jpg' width='200px' height='200px'></a><p>{$cd['name']}</p><p>{$cd['artist']}</p></td>";
                                        $i++;
                                    }
                                    echo '</tr>';
                                ?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/my_slide.js"></script>
    <script>
        $(".my_slide").mySlide({speed:500});

        $(".order_controll > li").click(function(){
             $.ajax({
                url:'get_sorted_list.php',
                type:'post',
                data:{'option':$(this).attr('id').substring(8)},
                dataType:'json',
                success:function(data)
                {
                    var content = '<tr>';
                    $.each(data,function(i,obj){
                        if(i % 4 == 0 && i != 0)
                            content += "</tr><tr>";
                        content += "<td><a href='cd_detail?id=" + obj.id + "'><img src='/static/img/cover/" + obj.id + ".jpg' width='200px' height='200px'></a><p>" + obj.name + "</p><p>" + obj.artist + "</p></td>";
                    });
                    content += "</tr>";
                    $("#cd_table > tbody").html(content);
                },
                error:function(){
                    alert('网络异常，请稍后再试');
                }
            });
        })
    </script>
</body>
</html>